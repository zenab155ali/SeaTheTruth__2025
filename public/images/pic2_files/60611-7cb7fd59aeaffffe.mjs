"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[60611],{791773:(t,e,n)=>{n.d(e,{Z:()=>a});let a=(0,n(667294).createContext)(null)},288544:(t,e,n)=>{n.d(e,{Z:()=>G});var a=n(667294),i=n(983272),r=n(630118),o=n(845729),s=n(248750),l=n(353168),p=n(770975),d=n(2171),c=n(337994),u=n(920301),m=n(431771),_=n(142921),g=n(301567);let f=t=>{let e=performance.getEntriesByType("resource").filter(t=>t.name.includes("i.pinimg")).reduce((t,e)=>{let n=e.name.replace(".jpg","").split("/");return{[n[n.length-1]]:{downloadSize:e.name.split("/")[3].split("x")[0]},...t}},{});[...Array.from(document.getElementsByTagName("img")).map(t=>{let n=t.src.replace(".jpg","").split("/"),a=n[n.length-1];if(e[a]){let n=g.rZ(t)?.width||1,i=e[a].downloadSize;return{fileName:a,renderedSize:n,downloadedSize:i,ratio:i/n}}return{fileName:a,renderedSize:1,downloadedSize:1,ratio:1}}),...Array.from(document.querySelectorAll('div[role="img"]')).map(t=>{let n=t.style.backgroundImage.split('"')[1].replace(".jpg","").split("/"),a=n[n.length-1];if(e[a]&&t instanceof HTMLDivElement){let n=g.rZ(t)?.width||1,i=e[a].downloadSize;return{fileName:a,renderedSize:n,downloadedSize:i,ratio:i/n}}return{fileName:a,renderedSize:1,downloadedSize:1,ratio:1}})].forEach(e=>{let{ratio:n,fileName:a,downloadedSize:i}=e;e.ratio>1.05&&(0,s.A9)(`checkImageRatio.${t}`,{count:Math.round(10*n)/10,tags:{fileName:`${i}_${a}`}})})};var y=n(147921),w=n(671481),T=n(730212);let A=(t,e)=>{let n=(0,a.useRef)(e);return{getState:()=>n.current,dispatch:e=>{n.current=t(n.current,e)}}};var I=n(493651),S=n(415787),E=n(785893);let M=["initial_app_load","client_route_push"],N=(0,o.XV)("PwtSurface"),h="NavigationComplete",v="VisuallyComplete",C=(t,e,n,a)=>{let{metricConfig:{metricId:i,pwtStaticContext:r,annotateExperiments:o},annotations:s,binaryAnnotations:l,constraintMap:p,startTime:m,imageTimings:_,isSampled:g,spans:f,traceId:y}=t,w=(0,d.N)({reason:e,annotateExperiments:o,annotations:s,binaryAnnotations:l,constraintMap:p,endTime:n,imageTimings:_,metricId:i,pwtStaticContext:r,startTime:m,traceId:y,spans:f});g&&!a&&(0,u.Z)({metricId:i,pwtStaticContext:r,result:w,annotateExperiments:o?["web_perf_logger_v4",...o]:["web_perf_logger_v4"]}),(0,c._T)()},b=(t,e,n)=>{let{metricConfig:{metricId:a,pwtStaticContext:i,annotateExperiments:o},annotations:p,binaryAnnotations:m,constraintMap:_,startTime:g,imageTimings:y,isSampled:w,spans:T,traceId:A}=t;(0,l.L8)(`Report_PWT_Complete_${(0,r.KJ)(a)}`,g,e);let I=(0,d.W)({annotateExperiments:[...o??[],"web_perf_logger_v4"],annotations:p,binaryAnnotations:m,constraintMap:_,endTime:e,imageTimings:y,metricId:a,pwtStaticContext:i,startTime:g,traceId:A,spans:T});w&&!n&&(0,u.Z)({metricId:a,pwtStaticContext:i,result:I,annotateExperiments:o?["web_perf_logger_v4",...o]:["web_perf_logger_v4"]});try{f(String(I.binaryAnnotationMap["metricId.surface"].value))}catch(t){(0,s.H)("image_ratio_check_error",{error:t})}return(0,c._T)(),{...t,result:I,status:"DONE"}},R=(t,e)=>{if(t.metricConfig.constraints.every(e=>t.constraintMap[e])){let n=Math.max(...t.metricConfig.constraints.map(e=>t.constraintMap[e]));return b(t,n,e)}return N(`Remaining constraints: ${t.metricConfig.constraints.filter(e=>!t.constraintMap[e]).join(", ")}`),t},O=(t,e)=>{let{constraint:n,time:a,disablePWTLogging:i}=e,o=(0,r.KJ)(t.metricConfig.metricId);return w.Z?t.metricConfig.constraints.find(t=>t===n)?t.constraintMap[n]?(N(`constraint "${n}" is already complete.`),(0,s.H)("duplicated_constraint_complete",{constraint:n,action:o}),t):(N(`marking constraint "${n}" as complete ${a||performance.now()}`),a?(0,l.ZP)(`constraint_${n}_is_complete`,a):(0,l.ZP)(`constraint_${n}_is_complete`),R({...t,constraintMap:{...t.constraintMap,[n]:a||w.Z.now()}},i)):(N(`marked constraint "${n}" is not a required constraint.`),t):((0,s.H)("missing_window_performance",{action:o}),t)},Z=(t,e)=>{if(!w.Z){let e=(0,r.KJ)(t.metricConfig.metricId);(0,s.H)("missing_window_performance",{action:e})}N(`removing constraint "${e}"`);let n=t.metricConfig.constraints.filter(t=>t!==e),{[e]:a,...i}=t.constraintMap;return R({...t,constraintMap:i,metricConfig:{...t.metricConfig,constraints:n}})},L=(t,e)=>{if(!w.Z){let e=(0,r.KJ)(t.metricConfig.metricId);(0,s.H)("missing_window_performance",{action:e})}N(`updating pwt segment to "${e}"`);let n={...t.metricConfig.metricId,segment:e};return{...t,metricConfig:{...t.metricConfig,metricId:n}}},P=(t,e)=>{let{metricConfig:n,startTime:a,isSampled:i,disablePWTLogging:o}=e;if(o||"TIMING"!==t.status||a===t.startTime||C(t,"routeUpdatedOnSameSurface",w.Z?.now()||0,o),!n)return{status:"DISABLED",metricConfig:null};let l=(0,r.KJ)(n.metricId);if("TIMING"===t.status&&t.startTime===a&&t.constraintMap[h])return(0,s.H)("duplicated_init_route_action",{action:l}),t;if(!o){let t=(0,I.H)();(0,s.A9)(`handler.${l}`,{tags:{handler:t}});let e=void 0!==n.metricId.isAuthenticated&&{tags:{isAuth:n.metricId.isAuthenticated}}||void 0;"Other"===n.pwtStaticContext.browserName&&!1===n.metricId.isAuthenticated&&"initial_app_load"===n.metricId.navigationType?((0,s.A9)(`TIMING.${l}`,{tags:{userAgent:window?.navigator?.userAgent}}),(0,s.A9)(`TIMING.sampled.${l}`,{tags:{userAgent:window?.navigator?.userAgent},sampleRate:.03})):((0,s.A9)(`TIMING.${l}`),(0,s.A9)(`TIMING.sampled.${l}`,{sampleRate:.03})),(0,u.C)({resultLog:`TIMING.${l}`,annotateExperiments:n.annotateExperiments||[],getExperimentGroup:n.pwtStaticContext.getExperimentGroup,options:e})}return O({traceId:(0,c.vc)()||(0,c.ZP)("initial_app_load"===n.metricId.navigationType,n.pwtStaticContext.serverData?.trace_id),status:"TIMING",metricConfig:n,startTime:a,constraintMap:{},annotations:{},binaryAnnotations:{},imageTimings:[],isSampled:i,spans:[]},{constraint:h,disablePWTLogging:o})},$=(t,e)=>{if(N("dispatch action",e),"INIT_ROUTE"===e.type)return P(t,e.payload);if("TIMING"!==t.status)return N(`ignoring action due to invalid state ${t.status}`,e),t;switch(e.type){case"ABORT":C(t,e.reason,w.Z?.now()||0);let n={type:"ABORT",reason:e.reason};return{...t,status:"DONE",result:n};case"ANNOTATE":let{name:a}=e.payload;if(!w.Z)return t;let i=w.Z.now();return N(`adding annotation {${a}: ${i}}`),{...t,annotations:{...t.annotations,[a]:i}};case"BINARY_ANNOTATE":let{name:o,value:l,annotationType:p}=e.payload;return N(`adding binary annotation {${o}: ${l}}`),{...t,binaryAnnotations:{...t.binaryAnnotations,[o]:{value:l,type:p}}};case"MARK_CONSTRAINT_COMPLETE":return O(t,e.payload);case"REMOVE_CONSTRAINT":return Z(t,e.payload);case"SET_SEGMENT":return L(t,e.payload);case"SET_VISUALLY_COMPLETE_RESULT":{let{payload:{imageTimings:n}}=e;if(0===n.length)return C(t,"visuallyComplete_noImages",w.Z?.now()||0),{...t,status:"DONE",result:{type:"ABORT",reason:"visuallyComplete_noImages"}};let a=Math.max(...n.map(t=>t.responseEnd||0));return O({...t,imageTimings:n},{constraint:v,time:a})}case"ADD_SUBSPAN":let{startTime:d}=t,{payload:{name:c,startTime:u,endTime:m,annotations:_,binaryAnnotations:g,parentId:f}}=e;return{...t,spans:[...t.spans,{name:c,id:(0,y.Z)(),startTime:u||d,endTime:m,annotationMap:{..._},binaryAnnotationMap:{...g},parentId:f}]};case"START_SUBSPAN":return{...t,spans:[...t.spans,{name:e.payload.name,id:(0,y.Z)(),startTime:w.Z?w.Z.now():0,endTime:1/0,annotationMap:{...e.payload.annotations},binaryAnnotationMap:{...e.payload.binaryAnnotations},parentId:e.payload.parentId}]};case"STOP_SUBSPAN":let T=t.spans.findIndex(t=>t.name===e.payload.name);return T>-1?(t.spans[T].endTime=w.Z?w.Z.now():0,e.payload.annotations&&(t.spans[T].annotationMap={...t.spans[T].annotationMap,...e.payload.annotations}),e.payload.binaryAnnotations&&(t.spans[T].binaryAnnotationMap={...t.spans[T].binaryAnnotationMap,...e.payload.binaryAnnotations})):(0,s.H)("invalid_subspan_stop_name",{name:e.payload.name}),t;default:let A=(0,r.KJ)(t.metricConfig.metricId);return(0,s.H)("invalid_pwt_surface_action",{action:A}),t}},B=t=>{if(!t)return"initial_app_load";switch(t.action){case"PUSH":return"client_route_push";case"REPLACE":return"client_route_replace";default:return null}},D=new Set,x=({surface:t,constraints:e,segment:n,measureGridVisuallyComplete:r,annotateExperiments:o,customEnabledNavigationTypes:s,navigationInfo:{clientNavigation:l,navigationType:p},sampleRate:d})=>{let c=(0,a.useRef)("NOT_SET"),u=(0,_.Z)(),{getState:m,dispatch:g}=A($,{status:"DISABLED",metricConfig:null}),f=(0,T.B)();if(c.current!==l&&(c.current=l,u)){let{isAuthenticated:a}=u,i=t&&p&&(s||M).includes(p)?{metricId:{type:"surface",surface:t,navigationType:p,isAuthenticated:a,segment:n},annotateExperiments:o,constraints:[h,...e||[],...r?[v]:[]],pwtStaticContext:u}:null;(0,S.nP)("webapp.pwt_surface.init_route",{tags:{surface:t,navigationType:p,isAuthenticated:a}});let c=!D.has(l);g({type:"INIT_ROUTE",payload:{metricConfig:i,startTime:l?l.time:0,isSampled:!d||Math.random()<d,disablePWTLogging:!c}}),c&&D.add(l)}let y=m();if((0,a.useEffect)(()=>()=>{D.delete(l)},[l]),(0,a.useEffect)(()=>{let t=t=>{g({type:"ABORT",reason:t})};i.Z.onSessionPause(t);let e=window.innerHeight,n=window.innerWidth,a=()=>{let t=Math.abs(window.innerHeight-e),i=Math.abs(window.innerWidth-n),r=window.innerHeight!==e,o=window.innerWidth!==n,s={handler:(0,I.H)(),deviceType:u?.deviceType??"unknown",isAuthenticated:u?.isAuthenticated??"unknown",platform:f.userAgent.platform??"unknown"};if((0,S.nP)("webapp.PwtLogger.handleResize",{sampleRate:1,tags:{...s,heightChanged:r,widthChanged:o}}),r&&(0,S.S0)("webapp.PwtLogger.resizeHeightDelta",t,{sampleRate:1,tags:s}),o&&(0,S.S0)("webapp.PwtLogger.resizeWidthDelta",i,{sampleRate:1,tags:s}),window.removeEventListener("resize",a),u?.deviceType==="phone"&&(!o&&r&&t<=150||!r&&!o)||u?.deviceType==="desktop"&&!r&&!o){(0,S.nP)("webapp.PwtLogger.skipResizeAbort",{sampleRate:1,tags:{...s,heightChanged:r,widthChanged:o}});return}g({type:"ABORT",reason:"windowResized"})};return window.addEventListener("resize",a),()=>{let e=m();N("handling unmount",e),"TIMING"===e.status&&C(e,"unmount",w.Z?.now()||0),i.Z.removePauseListener(t),window.removeEventListener("resize",a)}},[]),"TIMING"!==y.status||!y.constraintMap[h])return{state:y,context:null};let{startTime:E,metricConfig:b}=y;return{state:y,context:{abort:t=>g({type:"ABORT",reason:t}),addAnnotation:t=>g({type:"ANNOTATE",payload:{name:t}}),addBinaryAnnotation:(t,e,n)=>g({type:"BINARY_ANNOTATE",payload:{name:t,value:e,annotationType:n}}),addSubspan:(t,e,n,a={},i={},r=null)=>g({type:"ADD_SUBSPAN",payload:{name:t,startTime:e,endTime:n,annotations:a,binaryAnnotations:i,parentId:r}}),getId:()=>E,getMetricId:()=>b.metricId,markConstraintComplete:t=>g({type:"MARK_CONSTRAINT_COMPLETE",payload:{constraint:t,time:w.Z?w.Z.now():0}}),removeConstraint:t=>g({type:"REMOVE_CONSTRAINT",payload:t}),setSegment:t=>g({type:"SET_SEGMENT",payload:t}),setVisuallyCompleteResult:b.constraints.includes(v)?t=>g({type:"SET_VISUALLY_COMPLETE_RESULT",payload:t}):null,startSubspan:(t,e={},n={},a=null)=>g({type:"START_SUBSPAN",payload:{name:t,annotations:e,binaryAnnotations:n,parentId:a}}),stopSubspan:(t,e={},n={},a=null)=>g({type:"STOP_SUBSPAN",payload:{name:t,annotations:e,binaryAnnotations:n,parentId:a}})}}},H=()=>{let t=(0,p.E)(),e=!!t;(0,a.useEffect)(()=>{if(e){let e=t?.getMetricId(),n=e?(0,r.KJ)(e):null;(0,s.H)("nested_pwt_surface",{action:n})}},[e])};function G({children:t,...e}){let n=(0,m.Z)(),a=B(n),i=e.measureGridVisuallyComplete?["web_masonry_v2_auth","web_masonry_v2_unauth","web_fluid_grid_desktop_auth","web_fluid_grid_desktop_unauth"]:[],r=[...e.annotateExperiments??[],...i,"web_perf_logger_v4"],{context:o}=x({...e,annotateExperiments:r,navigationInfo:{navigationType:a,clientNavigation:n}});return H(),(0,E.jsx)(p.S,{value:o,children:t})}},431771:(t,e,n)=>{n.d(e,{Z:()=>r});var a=n(667294),i=n(791773);function r(){return(0,a.useContext)(i.Z)}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/60611-7cb7fd59aeaffffe.mjs.map